<!DOCTYPE html>
<html>
<head>
    <title></title>

    <script src="../Demo.js"></script>

    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        video {
            flex: 1;
            background: transparent;
            height: auto;
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>
    <!-- http://distribution.bbb3d.renderfarming.net/video/mp4/bbb_sunflower_1080p_60fps_normal.mp4 -->
    <video preload="auto" width="640" height="360" src="./le-grand-détournement.mp4"></video>

    <script>
        class SubtitlesDemo extends Demo {
            constructor(video) {
                super([
                    () => this.setContent('Tu connais pas sheraf ?'),
                    () => this.setContent('C\'est un groupe, ils étaient number one.'),
                    () => this.setAlign('right'),
                    () => this.setAlign('left'),
                    () => this.setAlign(),
                    () => this.setSize(50),
                    () => this.setSize(25),
                    () => this.setSize(),
                    () => this.setVertical('rl'),
                    () => this.setVertical('lr'),
                    () => this.setVertical(),
                    () => {
                        this.setLine(10);
                        this.setPosition(25);
                        this.setSize(50);
                        this.setAlign('center');
                    },
                    () => {
                        this.setLine(2);
                        this.setPosition(70);
                        this.setSize(30);
                        this.setAlign('right');
                    },
                    () => {
                        this.setLine();
                        this.setPosition();
                        this.setAlign();
                        this.setSize();
                    },
                ]);

                this.video = video;
                this.content = '';
                this.track = null;
                this.cue = null;

                this.onLoad = this.onLoad.bind(this);
                this.show = this.show.bind(this);
                this.hide = this.hide.bind(this);

                this.video.addEventListener('loadedmetadata', this.onLoad);
            }

            /**
             * On video loaded
             */
            onLoad() {
                this.track = this.video.addTextTrack('captions', 'Français', 'fr-FR');
                this.track.mode = 'showing';
                this.cue = new VTTCue(0, 60 * 10, this.content);
                this.track.addCue(this.cue);
            }

            start() {
                super.start();
                this.setLine();
                this.setPosition();
                this.setAlign();
                this.setSize();
                this.setContent();
                this.video.play();
            }

            stop() {
                super.stop();
                this.video.pause();
            }

            execute() {
                this.hide();
                super.execute();
                this.show();
            }

            hide() {
                this.track.mode = 'hidden';
            }

            show() {
                this.track.mode = 'showing';
            }

            setContent(content = '') {
                this.cue.text = content;
            }

            setAlign(align = 'center') {
                this.cue.align = align;
            }

            setSize(size = 100) {
                this.hide();
                this.cue.size = size;
                this.show();
            }

            setVertical(vertical = '') {
                this.cue.vertical = vertical;
            }

            setLine(line = 'auto') {
                this.cue.line = line;
            }

            setPosition(position = 'auto') {
                this.cue.position = position;
            }
        }

        const demo = new SubtitlesDemo(document.getElementsByTagName('video')[0]);

        if (typeof(parent.setDemo) === 'function') {
           parent.setDemo('subtitles', demo);
        } else {
            addEventListener('keypress', demo.next);
        }

        function resize() {
            document.body.style.width = `${window.innerWidth}px`;
            document.body.style.height = `${window.innerHeight}px`;
        }

        addEventListener('load', resize);
        addEventListener('resize', resize);
    </script>
</body>
</html>

